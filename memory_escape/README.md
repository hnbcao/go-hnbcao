## Golang 内存逃逸分析

### 逃逸分析的作用是什么呢？

    1.逃逸分析的好处是为了减少gc的压力，不逃逸的对象分配在栈上，当函数返回时就回收了资源，不需要gc标记清除。

    2.逃逸分析完后可以确定哪些变量可以分配在栈上，栈的分配比堆快，性能好(逃逸的局部变量会在堆上分配 ,而没有发生逃逸的则有编译器在栈上分配)。

    3.同步消除，如果你定义的对象的方法上有同步锁，但在运行时，却只有一个线程在访问，此时逃逸分析后的机器码，会去掉同步锁运行。

### 逃逸总结：

    1.栈上分配内存比在堆中分配内存有更高的效率
    
    2.栈上分配的内存不需要GC处理
    
    3.堆上分配的内存使用完毕会交给GC处理
    
    4.逃逸分析目的是决定内分配地址是栈还是堆
    
    5.逃逸分析在编译阶段完成

### 函数传递指针真的比传值效率高吗？

   我们知道传递指针可以减少底层值的拷贝，可以提高效率，但是如果拷贝的数据量小，由于指针传递会产生逃逸，可能会使用堆，也可能会增加GC的负担，所以传递指针不一定是高效的。

[Golang内存分配逃逸分析](https://driverzhang.github.io/post/golang%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90/)